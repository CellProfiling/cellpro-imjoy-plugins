<docs lang="markdown">
[TODO: make load data for varied HIT list, write documentation for this plugin.]
</docs>

<config lang="json">
{
  "name": "HPA-UMAP-HITS",
  "type": "web-python",
  "version": "0.1.0",
  "description": "Highlight RBP candidate list in HPA feats",
  "tags": [],
  "ui": "",
  "cover": "",
  "inputs": null,
  "outputs": null,
  "flags": [],
  "icon": "extension",
  "api_version": "0.1.8",
  "env": "",
  "permissions": [],
  "requirements": [],
  "dependencies": []
}
</config>

<script lang="python">
from js import fetch
import json
from imjoy import api

def get_loc_color(locs, ensg):
    if "," in locs or locs == "-1":
        return '#e0e0e030'
    else:
        return COLORS[int(locs)]

def get_color(locs, ensg, is_hit):
    if ':CBX5' in ensg:
        return 'black';
    elif is_hit:
        return get_loc_color(locs, ensg)
    else:
        return '#e0e0e030'

async def prepare_data():
    response = await fetch("https://gist.githubusercontent.com/oeway/75e0db98bbd039149ab8efe1fafb95fd/raw/hpa-umap-data-2d.json")
    data = await response.arrayBuffer()
    data = data.to_py().tobytes()
    data = json.loads(data)
    is_hit = [False] * len(data['customdata']['ensg'])
    for i, p in enumerate(data['customdata']['ensg']):
        for k in HITS:
            if ":" + k in p:
                is_hit[i] = True

    data['customdata']['hit'] = is_hit
    
    # list(filter(lambda x: "CBX5" in x, data['customdata']['ensg']))

    location_codes = [",".join([(CODES[loc] if loc in CODES else "-1") for loc in locs.split(',')]) for locs in data['customdata']['locations']]

    data['color'] = [ get_color(locs, ensg, is_hit) for locs, ensg, is_hit in zip(location_codes, data['customdata']['ensg'], data['customdata']['hit'])]

    key_mapping = {'locations': 'location', 'cell_line': 'cell_line', 'img': 'img', 'antibody': 'antibody', 'ensg':'gene', 'hit': 'hit'}
    data['metadata'] = [ {key_mapping[k]: v[i] for k,v in data['customdata'].items()} for i in range(len(location_codes))]
    return data

HITS = 'HSPA4,GNB2,TRIM28,KIF11,TACC3,POR,POLR1A,TTK,XPO1,PML,DKC1,PHF6,YWHAQ,RIPK1,GNAS,IKBKG,FHL1,TIAM1,RRAS2,DYNC1H1,WTAP,TRAF2,DNAJB12,TAOK2,TRMT2A,MLF2,TJP1,TUBB4B,SYNCRIP,U2AF2,GOLGB1,SFN,LPP,ATP2B1,SRPRB,MANF,GALNT2,CDC5L,NPM1,PTPN14,PABPC1,CLTC,MKI67,PARN,HNRNPR,TRA2B,SNRPD3,PA2G4,SENP1,SS18L1,CST3,PDCD6IP,PDLIM4,RRBP1,PRR12,AMOTL1,POLK,THRAP3,LASP1,USP36,SNAP23,SUMO3,POLR2A,CKAP4,LYN,XPO5,LRCH3,HNRNPA2B1,SUPT6H,NCAPD2,FMR1,PRPF19,PSME3,PTPN1,CKB,ALDH18A1,PAWR,UBXN1,PDE4DIP,SPTBN1,PPIB,VCP,AKAP9,MTHFD1,SRSF3,DNAJA1,SRSF1,VAPB,DCP1A,CLCC1,IQGAP1,CCDC50,TBC1D15,UBR4,ATIC,PTBP1,RPTOR,MCMBP,RBM7,SEC62,NEK9,PKP2,ZDHHC5,STX7,TMEM192,SYNGR2,NKRF,KIDINS220,USF1,PHB2,PCNA,ZFPL1,UBA1,KCTD3,FBL,KIF1B,RBM15,LARP1,HSPD1,TES,TNRC6A,KTN1,LDHA,TFRC,RCC1,DDX20,PRPF8,EMD,KPNA2,HADHA,WNK2,NSRP1,ACBD3,SH3GLB1,CYB5R3,SPEN,RBM39,NUCB2,SUGT1,CTNND1,ALX1,KRT18,HNRNPM,CELF1,HNRNPK,INPP4A,MCM7,TNPO1,HNRNPL,ARID1A,SMARCC1,CDC73,MBNL1,RAB9A,MYH9,ARID1B,RPA2,ATF7IP,KDM3B,ARFGAP2,ZFR,STAT3,MAPRE2,PDLIM5,ACP1,PCNT,SAFB,PTPN23,PTDSS1,KAT6A,RBM38,SETD5,CTPS1,IGF2BP2,PRCC,MYH10,HIP1R,TARDBP,SSB,CALD1,RBM5,LEMD2,PDIA4,SNW1,CSTB,DLG5,ALAS1,MTA2,COIL,ABCF1,ARNT,VIM,GPC6,ASPM,PSMC5,RRP1B,LSM14A,SLC3A2,FOXK1,NAV1,KIAA1671,SETDB1,FXR1,ATXN2,G3BP2,HCFC1,CEP57,TCF3,POLDIP3,PTK2,CBR1,NUP35,PDCD5,NOP58,BAG3,RPS14,PPP2R1A,ENO1,ACTN4,PDLIM7,PQBP1,CSDE1,KPNA6,SF1,P4HB,UTRN,ETFB,RNF216,ILF3,SRI,LDHB,AHNAK,TOP1,CCDC6,AIMP2,MIB1,SYNE1,DNAJC25,QKI,PPFIBP1,TAGLN2,NCKIPSD,CSTF1,AKAP1,ANKRD11,NCOR2,FLNB,SND1,PRKAR1A,HOXA10,MAPRE1,PKM,TFG,BAIAP2L1,ERC1,ELAC2,KIAA1549,UPF1,TPR,PPID,FAM120A,UBN2,AKAP13,ALYREF,NOM1,GSTP1,RUVBL1,RAPH1,DDX5,DNAAF5,IFT74,LONP1,IGF2BP3,CIZ1,ZC3HAV1L,RSBN1L,PSMC4,CNTRL,NSUN5,SHMT2,SERBP1,TBRG4,HSP90AA1,HSPH1,AASS,SETD1A,ABCF2,IMPDH2,TCF4,TNRC18,GNL3,STAU2,LMO7,HAUS6,CCT8,DUSP11,RNF114,GART,PHGDH,IGF2BP1,CSE1L,NPEPPS,SH3GL1,MCM3AP,TP53BP2,DVL2,EZR,MCM3,PMPCA,SETD1B,UBAP2,RBM33,NUP88,EIF4A3,EFTUD2,RRM1,RAD50,NKTR,TP53BP1,CHD1,TSC2,MAP1B,MSI2,ACLY,MRPS7,SAR1A,SUPT16H,PPP1CB,FEN1,HUWE1,GTF2F1,PFAS,STXBP4,MPRIP,WIZ,NBR1,DCAF7,RUFY3,CALCOCO2,FXR2,BICD2,DNAJC7,MRPL38,KIAA0753,LMAN1,CNP,ALDH7A1,SRP68,BAIAP2,CNTROB,PCM1,MRPL45,CEP55,DDX42,SON,SCRIB,CTBP2,NAA15,UBE2O,CEP95,NCDN,FBF1,TBC1D31,CASK,LIMA1,RAI1,EIF3E,NCL,GOPC,CEP131,SETX,DDX6,NCOA3,SENP6,TAX1BP1,TOP2A,FAM83H,ANKFY1,IARS2,TARBP1,RRP15,HOOK3,EIF4G3,KNTC1,FBLIM1,FKBP8,SMC1A,HMOX2,METAP1,PPP1R10,DDX24,ERH,TRIP11,SDCCAG8,CACYBP,PHF3,PRRC2C,XRCC5,MRPL37,PLEC,AURKA,PRRC2A,MEPCE,PDIA3,PDCD11,YES1,EBNA1BP2,RPL30,DARS2,ACADM,API5,RBMX2,GTF2I,CLTA,RBM28,APRT,CBLL1,USP24,POLD2,RNF2,RPN1,MAPK3,ZNF503,VDAC3,SSRP1,ZNF318,MTERF4,GNL2,RBM6,MASTL,NUDC,FTSJ1,PDCD4,PABPC4,PRDX4,GAK,PUM1,RC3H1,EXOC8,WDR3,ANXA11,CGN,DBNL,BCLAF1,LARP7,CBL,UNK,COPA,CCDC18,EPB41,NASP,UQCRC1,SASS6,NVL,CEP85,HELZ,DCTPP1,MSH6,CSK,ENAH,ZNF326,SDE2,TFB2M,EXOSC10,EIF4G1,AGL,LUZP1,EPB41L3,TARS2,SSBP1,ACSL4,MECR,SIPA1L1,PGRMC1,CEP120,NAP1L1,SRCAP,SERPINH1,PSMD10,SENP2,FLNA,RPS8,SUPT5H,HECTD1,SNRNP200,CCT4,SMG7,GAPVD1,SMC4,GTSE1,ATP13A3,TKT,RFC2,CPNE3,AFF4,MDN1,CCDC47,HDAC1,HBS1L,CDV3,CEP97,KPNB1,RRP36,EIF3I,NHSL1,ABI1,LAMTOR1,USP48,YTHDF2,SF3A1,NCAPH,IQGAP3,LTV1,CEP162,DST,RBM25,EIF3L,PUM2,PDIA5,PARD3,EIF4H,TTLL12,SRBD1,MRPL28,ZNF195,RCN2,NAA10,LRRC59,CEP350,TMX1,R3HDM1,TTC28,ZCCHC12,MCM4,OFD1,SART1,EP300,PGD,HOXB9,MCM2,CLUH,RP9,CAPZB,NSF,PPIL4,ASCC3,MOV10,AHCTF1,NUP107,WRNIP1,ZMYM2,RPS25,LATS1,SNAP29,MAGI1,MED12,CCT2,KIAA1522,SF3A3,TRNAU1AP,ZMYM3,TTLL5,RPS6KA3,PCMT1,CD2AP,ALDOC,RNF213,RPS24,RPL3,CDK1,DDX39B,RPL12,EIF3C,SYNE2,DDX1,UBE2C,PNPT1,DCTN1,PDIA6,TXNDC5,KHSRP,ZNF8,ZC3H8,DHX30,YBX3,MORC3,PKN2,SRSF6,TDRD3,RBM10,RAD54L2,XRN1,DYNC1LI1,NMD3,EEF1B2,ETAA1,MPHOSPH10,UBAP2L,ATP6V1A,RPLP0,PHLDB2,RABL3,PRKDC,CCDC14,PARD3B,PPIL2,DHX36,STAM2,PPM1G,MARS2,MAP7D3,SCAF8,AARS2,UTP3,RPS20,SCFD1,RBM20,CELF2,CDK5RAP2,SLAIN2,NOA1,GCC2,FAM50A,ADD1,LYAR,PALLD,ZFYVE16,SDAD1,KMT2D,FSCN1,BUB3,DHX57,THUMPD3,UMPS,RBM3,EIF2A,GNL3L,GSE1,OBSL1,LRPPRC,YTHDC1,GPRIN1,TBCA,DDX46,SCLT1,MATR3,LARP4B,HNRNPA0,BMS1,DDX21,OTUD4,RBM15B,GRPEL1,TRMT10C,FARSB,SLC4A1AP,PLCG1,PSMD1,PDHB,CWC22,ANKS1A,ZNF638,TCF20,TATDN2,TRIP12,ABCE1,RIF1,DCLRE1A,HMGCS1,DNAJC13,RAI14,PGAM5,GRSF1,PFN1,DSP,BOD1L1,NOLC1,DDX50,GEMIN5,IQGAP2,FIP1L1,RBM17,MPHOSPH9,UIMC1,POLR2B,FAM120B,POLR1B,U2SURP,MKRN2,FAM168A,KIF5B,QRICH1,MAML1,AURKB,GBF1,WDR36,NAA40,DLAT,COPG1,TUBGCP2,SIMC1,IQSEC1,MAP4,CWF19L2,WDR75,HNRNPH3,PRKAR2A,PRPF40A,USO1,MCCC2,EIF3A,FRS2,R3HDM2,BCR,PCBP2,SUPV3L1,MTCH2,PXN,PDHX,TTC17,MRPS35,RNF111,CEP295,PLEKHA7,TOLLIP,MIF,PSMD13,AP3B1,CD99L2,RUFY1,HSPA5,CCDC77,SCAF11,YAP1,PPHLN1,PSPC1,ADAR,ABLIM1,EPS8,DYNC2H1,MMAB,HSP90B1,PATL1,DDX23,EIF4B,AKAP11,HSPA4L,RNH1,UNC45A,TP53,TRAFD1,DIS3,CDC37,STIP1,SPTBN2,LARP4,RNF214,DNAJC3,SFSWAP,CHID1,CCP110,CEP152,RACGAP1,SMCHD1,ERP29,FNBP4,DDX51,SUCLA2,NOP14,GTPBP4,DCP1B,WBP11,DCTN2,GOLGA3,C15orf39,CPSF6,GAPDH,RSRC2,AAAS,EIF5B,NOP2,ZC3H13,TBC1D4,PES1,RBM26,SLTM,CLPX,YBX1,PJA2,CKAP5,C2CD3,SPAG9,CEP68,CEP192,FERMT2,G3BP1,EEF2,CLIC1,GIT1,RPRD1A,AQR,TFAM,ANKRD26,FOXC1,PMPCB,EEF1G,LEO1,ZNF609,PCF11,SLAIN1,VPS35,ZC3H7A,NIPBL,ZC3H18,DNAJA3,MGME1,ZC3H4,KIAA1328,RALY,NCKAP5L,DDX18,TRAP1,CPSF7,RNF138,PSMF1,TRMT1,SF3B3,PTCD3,EDC4,PYGL,HYLS1,LSM14B,PPP1R12A,TELO2,CIAPIN1,RPL14,PLEKHA5,TRIM9,ATXN2L,CD2BP2,PAICS,SUGP2,RAB5C,TBCB,RBBP6,RPAP1,ZNF598,CARS2,ALDOA,LRP1,HDLBP,SDHA,EIF3G,DAZAP1,LRRFIP2,SNRNP70,SMARCA4,CREBBP,CEP170,EIF5,PPFIA1,CENPE,EWSR1,SETD2,AKAP8L,TBL3,AHCYL1,WAC,WDR6,RELA,QTRT1,THOC3,CSTF2,BRD2,PSMC6,SRRT,RUVBL2,RANGAP1,MAT2A,ACTN1,RNF126,TIMM44,WDR70,KRI1,FAM193A,ALMS1,SMC3,ST13,NCOR1,RBM12,CLINT1,EARS2,FAM3C,TRIM33,VDAC2,MRPS9,SRSF5,MRPS18B,TRIM24,UACA,STUB1,CARM1,PAF1,MAGED1,MRPL1,RBM42,DIDO1,PRPS1,PCBP1,SEC23A,SRSF7,COPB1,ANKRD50,ROCK2,VTI1B,CRYBG3,CCDC66,DHCR7,ACAT1,BCAR1,LAS1L,MTR,ARHGAP39,DNTTIP2,DCAF13,AHCY,UTP15,SPDL1,RSRC1,AFG3L2,OCIAD1,LZTS2,LSM3,TRIM26,SF3B2,SIN3A,DDB1,KIF23,WASF2,TXLNA,SIPA1L3,NF1,PUF60,RAVER2,TBK1,SNX27,SQSTM1,EIF3D,NPAT,HNRNPLL,CTNNA1,UBTF,RSF1,HNRNPUL1,MRPS31,RPAP2,RPA1,POLD1,WDR33,SNRPA,WNK1,STIL,GMPS,HNRNPAB,WDR44,RPL7A,PPP1CA,DDOST,KPNA3,HEATR1,DDX10,DHX15,DDX27,RPS3A,PRPF6,XRN2,KIF2A,NUP50,PDCD6,GFPT1,GMNN,PDXDC1,TXN,TLN1,SFPQ,XRCC6,DHX37,FUBP3,USP54,AKAP8,ZC3HAV1,BOP1,THOC2,RBMS1,SPTY2D1,SYAP1,YLPM1,MCM6,RFWD3,ZYX,THOC5,NSD1,CCAR1,YTHDF3,HGS,NUP214,IK,MYEF2,ODF2,PTPN13,SUGP1,CCNT1,EIF3B,CNN2,HNRNPD,RFC4,ASNS,DHX8,UTP20,FKBP2,SEC61B,UHRF1,SLX4,SMPD4,RAVER1,AK4,IRF2BP1,PSMC2,CNOT1,RPS11,NNT,DNAJA2,ZC3H14,SRSF9,PACSIN2,STAU1,CCDC138,NOP56,AIP,NCOA5,KIAA0586,CASC3,SF3B1,ESF1,EIF5A,KRBA1,HTATSF1,LMNB1,ANLN,SAFB2,GIGYF2,TPI1,SRSF4,EIF3J,EEF1D,ARFGAP1,AKAP17A,HNRNPC,ZNF281,CNN3,ZW10,NCOA4,MRPL4,KHDRBS1,ZMYM4,DBN1,TBL2,TTC13,PDZD8,GTF3C1,RPL24,MRPL21,RADIL,NFS1,BRD3,ZNF217,FASN,TAF15,HSPA9,PIBF1,AKNA,CENPF,EYA3,GSPT1,ELAVL1,SUSD5,TRIP6,MCM5,RBBP8,INTS1,RB1CC1,RBM12B,CHD7,SEC63,CRKL,HMGB2,RAB1A,TRIM27,CENPB,CASP8AP2,RTCB,KPNA1,PTPN11,RPL10A,SRSF10,EVPL,SLC39A7,TRA2A,NONO,TLE3,TUBB,RNF40,ZNF106,ATR,CC2D1A,TRRAP,RAB11B,KIF1A,RPL5,IRAK1,UBE2M,SEC31A,SCAF1,IRS2,RABGAP1L,TPX2,SMC5,SECISBP2,RPS18,RPS2,RPL18A,PRMT5,ARVCF,STX12,TNS3,CLK2,PSMA4,DLGAP5,STRAP,KEAP1,FARP2,HSP90AB1,CAND1,MRPS5,RPS5,NOL6,EEF2K,SLC7A5,KANK1,DDX52,CSPP1,CCDC120,NFX1,HNRNPUL2,HNRNPDL,SEC24A,QSER1,SEC16A,BLM,SUMO1,TIA1,CTTN,CAD,EPB41L2,ZBTB33,PIAS1,NAT10,DCP2,BAZ2A,ARHGAP21,NUP54,CEP63,COPB2,MGA,KIF14,MTPAP,CCDC88C,CCDC85C,EXD2,ADPGK,HNRNPU,RBM19,DNMT1,TRIM25,NFXL1,FHL2,CDK13,OCLN,ZNF620,NIN,SS18,IPO9,CCT5,PJA1,DOCK11,NUP133,STK26,SENP3,CEP128,CENPJ,CIRBP,TOPORS,PSMC3,MRPS22,CTR9,SMNDC1,BUB1,FLNC,GFM1,GANAB,FKBP4,FUBP1,PHLDB1,NXF1,GRIPAP1,PEF1,TSG101,RPRD2,AJUBA,LIN28B,IWS1,ICE1,TSFM,CAMSAP3,KIF2C,TBKBP1,NUCKS1,USP15,RBFOX2,LMNB2,ZNF691,ATP2A2,MEX3A,NOL8,ELAVL2,AMOTL2,CNBP,DDX17,HELLS,RPS3,RBM47,RPS12,POLRMT,SLC12A2,ADNP,ANKRD17,VCL,CDC42EP1,ARFGAP3,PPP1R13B,LIMD1,RPS16,PLIN3,ANXA7,TAF7,CEP290,MSI1,IPO4,CCNK,NDUFS1,SF3B4,ATRX,MRPL2,CXorf56,CEP250,CPSF1,AP1B1,AMER1,ZFP91,CCT3,GEMIN4,DAXX,ACIN1,TCF12,ZFYVE9,RANBP1,FAF2,LARS2,NAF1,EDC3,POP1,RBM14,CDK5RAP1,HNRNPA3,PAG1,PKP4,EPPK1,MSH2,CLASP2,RTF1,FASTKD2,USP10,ARIH2,PIAS3,PSMD11,NUFIP2,PITRM1,USP5,CNOT2,EIF4G2,MACF1,DICER1,NINL,WBP2,MDC1,PIK3R2,DAGLB,DLG1,RAB7A,HNRNPF,TCERG1,SACM1L,PAK4,NCOA1,TFCP2,WDR1,TTF2,GALK1,ACSL3,DTNA,MTOR,CDC42BPA,SMC2,NFATC1,HNRNPA1,CASKIN2,TNIP1,MCM10,ALKBH5,PRMT1,CBFA2T2,INTS7,YTHDC2,LSR,OTUB1,PDLIM1,CTTNBP2NL,CEP135,SMG1,TDP2,NUDT21,GLI2,AP3D1,BIRC6,NUP98,ANKLE2,ILF2,CEP72,MTHFD1L,CIT,PI4KA,SSX2IP,PLS3,FARP1,RNF113A,DIAPH1,ESYT1,TMED3,LEMD3,POLDIP2,PRDX1,IGFBP2,MAP3K5,IDH2,HLA-A,FNDC3B,SPTAN1,TMPO,NUCB1,ME2,SUN1,CKAP2,BUB1B,TXLNG,CCT7,MAGI3,YWHAE,FAM98B,LRRC47,PRDX6,TMF1,PSMC1,PITX1,SMARCA5,FUS,FDFT1,CCDC22,FNDC3A,IPO5,ATP7B,VAPA,XIAP,TJP2,CCPG1,CANX,RPSA,SNRPB,KHDRBS3,GOLGA5,MPP5,ZNF451,PPAT,POC5,SEC24B,SALL2,VPS37C,FHL3,PTBP3,UCK2,TRIP13,TIAL1,TNRC6C,USP42,HDAC2,DHX9,CHD4,DEK,HLTF,RBM22,ZNF207,RAB11FIP1,NENF,FYCO1,PARP1,SEC23IP,NOSIP,HIRIP3,PRPF38A,ZRANB2,BCOR,CLASRP,EP400,DDX41,EEA1,RBM45,IPO8,AHDC1,GRB2,MED15,PIK3C2A,NSUN2,RRP9,SEC24C,LENG8,HMGN5,CMPK1,RRAGC,HMGB1,NUP188,PHF8,TLE4,GATA6,HIPK2,CDK12,RAN,ITPR3'
HITS = HITS.split(',')

COLORS = [
    '#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5',
    '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50',
    '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800',
    '#ff5722', '#795548', '#009e9e', '#607d8b', '#d500f9',
    '#212121', '#ff9e80', '#ff6d00', '#ffff00', '#76ff03',
    '#00e676', '#64ffda', '#18ffff',
]
LABELS = {
0:  'Nucleoplasm',
1:  'Nuclear membrane',
2:  'Nucleoli',
3:  'Nucleoli fibrillar center',
4:  'Nuclear speckles',
5:  'Nuclear bodies',
6:  'Endoplasmic reticulum',
7:  'Golgi apparatus',
8:  'Peroxisomes',
9:  'Endosomes',
10:  'Lysosomes',
11:  'Intermediate filaments',
12:  'Actin filaments',
13:  'Focal adhesion sites',
14:  'Microtubules',
15:  'Microtubule ends',
16:  'Cytokinetic bridge',
17:  'Mitotic spindle',
18:  'Microtubule organizing center',
19:  'Centrosome',
20:  'Lipid droplets',
21:  'Plasma membrane',
22:  'Cell junctions',
23:  'Mitochondria',
24:  'Aggresome',
25:  'Cytosol',
26:  'Cytoplasmic bodies',
27:  'Rods & rings' }

CODES = {v: str(k) for k,v in LABELS.items()}


async def setup():
    plot = await api.createWindow(
        src="https://gist.githubusercontent.com/oeway/c0b83ac6a12dd00dd978dff35c346cd3/raw/HPA-UMAP-CR.imjoy.html",
        fullscreen=True,
    )
    data = await prepare_data();
    await plot.display(data)

api.export({"setup": setup})
</script>
